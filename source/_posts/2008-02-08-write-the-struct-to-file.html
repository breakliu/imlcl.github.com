---
layout: post
title: 把结构体写入到文件
categories:
- geek
tags:
- C
published: true
comments: true
---
<p><p>今天看到网上一个乱七八糟的乱子，整理一下：<br /><font size="2"><font face="Courier New"><span class="SpanClass9"><font color="#804000">#include&nbsp;&lt;stdio.h&gt;&nbsp;&nbsp;&nbsp;<br />#include&nbsp;&lt;string.h&gt;&nbsp;&nbsp;&nbsp;<br /></font></span><span class="SpanClass16"><font color="#8000ff">struct</font></span><span class="SpanClass0">&nbsp;</span><span class="SpanClass11">ST</span></font></font><font size="2"><font face="Courier New"><span class="SpanClass0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br /></span><span class="SpanClass10"><strong><font color="#000080">{</font></strong></span></font></font><font size="2"><font face="Courier New"><span class="SpanClass0">&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="SpanClass16"><font color="#8000ff">int</font></span><span class="SpanClass0">&nbsp;</span><span class="SpanClass11">NO</span><span class="SpanClass10"><strong><font color="#000080">;</font></strong></span></font></font><font size="2"><font face="Courier New"><span class="SpanClass0">&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="SpanClass16"><font color="#8000ff">char</font></span><span class="SpanClass0">&nbsp;</span><span class="SpanClass11">name</span><span class="SpanClass10"><strong><font color="#000080">[</font></strong></span><span class="SpanClass4"><font color="#ff8000">16</font></span><span class="SpanClass10"><strong><font color="#000080">];</font></strong></span></font></font><font size="2"><font face="Courier New"><span class="SpanClass0">&nbsp;&nbsp;&nbsp;<br /></span><span class="SpanClass10"><strong><font color="#000080">};</font></strong></span></font></font><font size="2"><font face="Courier New"><span class="SpanClass0">&nbsp;&nbsp;&nbsp;<br /></span><span class="SpanClass16"><font color="#8000ff">int</font></span><span class="SpanClass0">&nbsp;</span><span class="SpanClass11">main</span><span class="SpanClass10"><strong><font color="#000080">()</font></strong></span></font></font><font size="2"><font face="Courier New"><span class="SpanClass0">&nbsp;&nbsp;&nbsp;<br /></span><span class="SpanClass10"><strong><font color="#000080">{</font></strong></span></font></font><span class="SpanClass0"><br /><font face="Courier New" size="2">&nbsp;&nbsp;&nbsp;&nbsp;</font></span><font size="2"><font face="Courier New"><span class="SpanClass11">ST</span><span class="SpanClass0">&nbsp;</span><span class="SpanClass11">test</span><span class="SpanClass10"><strong><font color="#000080">;</font></strong></span></font></font><span class="SpanClass0"><br /><font face="Courier New" size="2">&nbsp;&nbsp;&nbsp;&nbsp;</font></span><font size="2"><font face="Courier New"><span class="SpanClass11">ST</span><span class="SpanClass0">&nbsp;</span><span class="SpanClass11">read</span><span class="SpanClass10"><strong><font color="#000080">;</font></strong></span></font></font><font size="2"><font face="Courier New"><span class="SpanClass0">&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="SpanClass11">FILE</span><span class="SpanClass0">&nbsp;</span><span class="SpanClass10"><strong><font color="#000080">*</font></strong></span><span class="SpanClass11">pFile</span><span class="SpanClass10"><strong><font color="#000080">;</font></strong></span></font></font><font size="2"><font face="Courier New"><span class="SpanClass0">&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="SpanClass11">test</span><span class="SpanClass10"><strong><font color="#000080">.</font></strong></span><span class="SpanClass11">NO</span><span class="SpanClass0">&nbsp;</span><span class="SpanClass10"><strong><font color="#000080">=</font></strong></span><span class="SpanClass0">&nbsp;</span><span class="SpanClass4"><font color="#ff8000">1</font></span><span class="SpanClass10"><strong><font color="#000080">;</font></strong></span></font></font><font size="2"><font face="Courier New"><span class="SpanClass0">&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="SpanClass11">strcpy</span><span class="SpanClass10"><strong><font color="#000080">(</font></strong></span><span class="SpanClass11">test</span><span class="SpanClass10"><strong><font color="#000080">.</font></strong></span><span class="SpanClass11">name</span><span class="SpanClass10"><strong><font color="#000080">,</font></strong></span><span class="SpanClass0">&nbsp;</span><span class="SpanClass6"><font color="#808080">"slackcode.cn"</font></span><span class="SpanClass10"><strong><font color="#000080">);</font></strong></span></font></font><span class="SpanClass0"><br /><font face="Courier New" size="2">&nbsp;&nbsp;&nbsp;&nbsp;</font></span><font size="2"><font face="Courier New"><span class="SpanClass11">pFile</span><span class="SpanClass0">&nbsp;</span><span class="SpanClass10"><strong><font color="#000080">=</font></strong></span><span class="SpanClass0">&nbsp;</span><span class="SpanClass11">fopen</span><span class="SpanClass10"><strong><font color="#000080">(</font></strong></span><span class="SpanClass6"><font color="#808080">"file1.dat"</font></span><span class="SpanClass10"><strong><font color="#000080">,</font></strong></span><span class="SpanClass0">&nbsp;</span><span class="SpanClass6"><font color="#808080">"w+"</font></span><span class="SpanClass10"><strong><font color="#000080">);</font></strong></span></font></font><span class="SpanClass0"><br /><font face="Courier New" size="2">&nbsp;&nbsp;&nbsp;&nbsp;</font></span><font size="2"><font face="Courier New"><span class="SpanClass5"><strong><font color="#0000ff">if</font></strong></span><span class="SpanClass0">&nbsp;</span><span class="SpanClass10"><strong><font color="#000080">(</font></strong></span><span class="SpanClass0">&nbsp;</span><span class="SpanClass10"><strong><font color="#000080">!</font></strong></span><span class="SpanClass11">pFile</span><span class="SpanClass0">&nbsp;</span><span class="SpanClass10"><strong><font color="#000080">)</font></strong></span></font></font><span class="SpanClass0"><br /><font face="Courier New" size="2">&nbsp;&nbsp;&nbsp;&nbsp;</font></span><span class="SpanClass10"><strong><font face="Courier New" color="#000080" size="2">{</font></strong></span><span class="SpanClass0"><br /><font face="Courier New" size="2">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font></span><font size="2"><font face="Courier New"><span class="SpanClass11">printf</span><span class="SpanClass10"><strong><font color="#000080">(</font></strong></span><span class="SpanClass6"><font color="#808080">"open&nbsp;file&nbsp;error!"</font></span><span class="SpanClass10"><strong><font color="#000080">);</font></strong></span></font></font><span class="SpanClass0"><br /><font face="Courier New" size="2">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font></span><font size="2"><font face="Courier New"><span class="SpanClass5"><strong><font color="#0000ff">return</font></strong></span><span class="SpanClass0">&nbsp;</span><span class="SpanClass10"><strong><font color="#000080">-</font></strong></span><span class="SpanClass4"><font color="#ff8000">1</font></span><span class="SpanClass10"><strong><font color="#000080">;</font></strong></span></font></font><span class="SpanClass0"><br /><font face="Courier New" size="2">&nbsp;&nbsp;&nbsp;&nbsp;</font></span><span class="SpanClass10"><strong><font face="Courier New" color="#000080" size="2">}</font></strong></span><span class="SpanClass0"><br /><font face="Courier New" size="2">&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;</font></span><font size="2"><font face="Courier New"><span class="SpanClass11">rewind</span><span class="SpanClass10"><strong><font color="#000080">(</font></strong></span><span class="SpanClass11">pFile</span><span class="SpanClass10"><strong><font color="#000080">);</font></strong></span></font></font><span class="SpanClass0"><br /><font face="Courier New" size="2">&nbsp;&nbsp;&nbsp;&nbsp;</font></span><font size="2"><font face="Courier New"><span class="SpanClass11">fwrite</span><span class="SpanClass10"><strong><font color="#000080">(&amp;</font></strong></span><span class="SpanClass11">test</span><span class="SpanClass10"><strong><font col<br />
or="#000080">,</strong></span></font><span class="SpanClass0">&nbsp;</span><span class="SpanClass5"><font color="#0000ff"><strong>sizeof</strong></font></span><span class="SpanClass10"><strong><font color="#000080">(</font></strong></span><span class="SpanClass11">ST</span><span class="SpanClass10"><strong><font color="#000080">),</font></strong></span><span class="SpanClass0">&nbsp;</span><span class="SpanClass4"><font color="#ff8000">1</font></span><span class="SpanClass10"><strong><font color="#000080">,</font></strong></span><span class="SpanClass0">&nbsp;</span><span class="SpanClass11">pFile</span><span class="SpanClass10"><strong><font color="#000080">);</font></strong></span></font><span class="SpanClass0"><br /><br /><font face="Courier New" size="2">&nbsp;&nbsp;&nbsp;&nbsp;</font></span><font size="2"><font face="Courier New"><span class="SpanClass11">rewind</span><span class="SpanClass10"><strong><font color="#000080">(</font></strong></span><span class="SpanClass11">pFile</span><span class="SpanClass10"><strong><font color="#000080">);</font></strong></span></font></font><span class="SpanClass0"><br /><font face="Courier New" size="2">&nbsp;&nbsp;&nbsp;&nbsp;</font></span><font size="2"><font face="Courier New"><span class="SpanClass11">fread</span><span class="SpanClass10"><strong><font color="#000080">(&amp;</font></strong></span><span class="SpanClass11">read</span><span class="SpanClass10"><strong><font color="#000080">,</font></strong></span><span class="SpanClass0">&nbsp;</span><span class="SpanClass5"><font color="#0000ff"><strong>sizeof</strong></font></span><span class="SpanClass10"><strong><font color="#000080">(</font></strong></span><span class="SpanClass11">ST</span><span class="SpanClass10"><strong><font color="#000080">),</font></strong></span><span class="SpanClass0">&nbsp;</span><span class="SpanClass4"><font color="#ff8000">1</font></span><span class="SpanClass10"><strong><font color="#000080">,</font></strong></span><span class="SpanClass0">&nbsp;</span><span class="SpanClass11">pFile</span><span class="SpanClass10"><strong><font color="#000080">);</font></strong></span></font></font><span class="SpanClass0"><br /><br /><font face="Courier New" size="2">&nbsp;&nbsp;&nbsp;&nbsp;</font></span><font size="2"><font face="Courier New"><span class="SpanClass11">printf</span><span class="SpanClass10"><strong><font color="#000080">(</font></strong></span><span class="SpanClass6"><font color="#808080">"%d,&nbsp;%s\n"</font></span><span class="SpanClass10"><strong><font color="#000080">,</font></strong></span><span class="SpanClass0">&nbsp;</span><span class="SpanClass11">read</span><span class="SpanClass10"><strong><font color="#000080">.</font></strong></span><span class="SpanClass11">NO</span><span class="SpanClass10"><strong><font color="#000080">,</font></strong></span><span class="SpanClass0">&nbsp;</span><span class="SpanClass11">read</span><span class="SpanClass10"><strong><font color="#000080">.</font></strong></span><span class="SpanClass11">name</span><span class="SpanClass10"><strong><font color="#000080">);</font></strong></span></font></font><span class="SpanClass0"><br /><br /><font face="Courier New" size="2">&nbsp;&nbsp;&nbsp;&nbsp;</font></span><font size="2"><font face="Courier New"><span class="SpanClass11">fclose</span><span class="SpanClass10"><strong><font color="#000080">(</font></strong></span><span class="SpanClass11">pFile</span><span class="SpanClass10"><strong><font color="#000080">);</font></strong></span></font></font><span class="SpanClass0"><br /><font face="Courier New" size="2">&nbsp;&nbsp;&nbsp;&nbsp;</font></span><font size="2"><font face="Courier New"><span class="SpanClass5"><strong><font color="#0000ff">return</font></strong></span><span class="SpanClass0">&nbsp;</span><span class="SpanClass4"><font color="#ff8000">0</font></span><span class="SpanClass10"><strong><font color="#000080">;</font></strong></span></font></font><span class="SpanClass0"><br /></span><span class="SpanClass10"><strong><font face="Courier New" color="#000080" size="2">}</font></strong></span></p></p>
