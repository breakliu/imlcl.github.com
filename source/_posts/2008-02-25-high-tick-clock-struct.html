---
layout: post
title: 写了个高精度时间计算器的struct
categories:
- geek
tags:
- QueryPerformanceCounter
- QueryPerformanceFrequency
- struct
- timer
- 时间
- 高精度
published: true
comments: true
---
<p><p align="left">感觉经常要测程序的性能，就写了个简单的结构体，方便自己以后调用。简单起见，没有处理QueryPerformanceCounter与QueryPerformanceFrequency调用失败的情况。</p></p>

<p><!--more-->
<span class="SpanClass9"><font face="Courier New" color="#804000" size="2">#include&nbsp;"stdafx.h"<br />#include&nbsp;&lt;Windows.h&gt;<br />#include&nbsp;&lt;stdio.h&gt;<br /></font></span><span class="SpanClass0"><br /></span><font size="2"><font face="Courier New"><span class="SpanClass16"><font color="#8000ff">struct</font></span><span class="SpanClass0">&nbsp;</span><span class="SpanClass11">HighPreTimer</span></font></font><span class="SpanClass0"><br /></span><span class="SpanClass10"><strong><font face="Courier New" color="#000080" size="2">{</font></strong></span><span class="SpanClass0"><br /></span><font size="2"><font face="Courier New"><span class="SpanClass16"><font color="#8000ff">private</font></span><span class="SpanClass10"><strong><font color="#000080">:</font></strong></span></font></font><span class="SpanClass0"><br /><font face="Courier New" size="2">&nbsp;&nbsp;&nbsp;&nbsp;</font></span><font size="2"><font face="Courier New"><span class="SpanClass11">LARGE_INTEGER</span><span class="SpanClass0">&nbsp;</span><span class="SpanClass11">timeStart</span><span class="SpanClass10"><strong><font color="#000080">;</font></strong></span></font></font><span class="SpanClass0"><br /><font face="Courier New" size="2">&nbsp;&nbsp;&nbsp;&nbsp;</font></span><font size="2"><font face="Courier New"><span class="SpanClass11">LARGE_INTEGER</span><span class="SpanClass0">&nbsp;</span><span class="SpanClass11">timeEnd</span><span class="SpanClass10"><strong><font color="#000080">;</font></strong></span></font></font><span class="SpanClass0"><br /><font face="Courier New" size="2">&nbsp;&nbsp;&nbsp;&nbsp;</font></span><font size="2"><font face="Courier New"><span class="SpanClass11">LARGE_INTEGER</span><span class="SpanClass0">&nbsp;</span><span class="SpanClass11">cpuFreq</span><span class="SpanClass10"><strong><font color="#000080">;</font></strong></span></font></font><span class="SpanClass0"><br /><br /></span><font size="2"><font face="Courier New"><span class="SpanClass16"><font color="#8000ff">public</font></span><span class="SpanClass10"><strong><font color="#000080">:</font></strong></span></font></font><span class="SpanClass0"><br /><font face="Courier New" size="2">&nbsp;&nbsp;&nbsp;&nbsp;</font></span><font size="2"><font face="Courier New"><span class="SpanClass11">HighPreTimer</span><span class="SpanClass10"><strong><font color="#000080">()</font></strong></span></font></font><span class="SpanClass0"><br /><font face="Courier New" size="2">&nbsp;&nbsp;&nbsp;&nbsp;</font></span><span class="SpanClass10"><strong><font face="Courier New" color="#000080" size="2">{</font></strong></span><font size="2"><font face="Courier New"><span class="SpanClass0">&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="SpanClass11">memset</span><strong><span class="SpanClass10"><font color="#000080">(</font></span><span class="SpanClass5"><font color="#0000ff">this</font></span></strong><span class="SpanClass10"><strong><font color="#000080">,</font></strong></span><span class="SpanClass0">&nbsp;</span><span class="SpanClass4"><font color="#ff8000">0</font></span><span class="SpanClass10"><strong><font color="#000080">,</font></strong></span><span class="SpanClass0">&nbsp;</span><span class="SpanClass5"><font color="#0000ff"><strong>sizeof</strong></font></span><span class="SpanClass10"><strong><font color="#000080">(</font></strong></span><span class="SpanClass11">HighPreTimer</span><span class="SpanClass10"><strong><font color="#000080">));</font></strong></span></font></font><font size="2"><font face="Courier New"><span class="SpanClass0">&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="SpanClass10"><strong><font color="#000080">}</font></strong></span></font></font><span class="SpanClass0"><br /><br /><font face="Courier New" size="2">&nbsp;&nbsp;&nbsp;&nbsp;</font></span><font size="2"><font face="Courier New"><span class="SpanClass16"><font color="#8000ff">double</font></span><span class="SpanClass0">&nbsp;</span><span class="SpanClass11">GetTime</span><span class="SpanClass10"><strong><font color="#000080">()</font></strong></span></font></font><span class="SpanClass0"><br /><font face="Courier New" size="2">&nbsp;&nbsp;&nbsp;&nbsp;</font></span><span class="SpanClass10"><strong><font face="Courier New" color="#000080" size="2">{</font></strong></span><span class="SpanClass0"><br /><font face="Courier New" size="2">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font></span><font size="2"><font face="Courier New"><span class="SpanClass11">QueryPerformanceFrequency</span><span class="SpanClass10"><strong><font color="#000080">(</font></strong></span><span class="SpanClass0">&nbsp;</span><span class="SpanClass10"><strong><font color="#000080">&amp;</font></strong></span><span class="SpanClass11">cpuFreq</span><span class="SpanClass0">&nbsp;</span><span class="SpanClass10"><strong><font color="#000080">);</font></strong></span></font></font><span class="SpanClass0"><br /><font face="Courier New" size="2">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font></span><font size="2"><font face="Courier New"><span class="SpanClass5"><strong><font color="#0000ff">return</font></strong></span><span class="SpanClass0">&nbsp;</span><span class="SpanClass10"><strong><font color="#000080">(</font></strong></span><span class="SpanClass16"><font color="#8000ff">double</font></span><span class="SpanClass10"><strong><font color="#000080">)(</font></strong></span><span class="SpanClass11">timeEnd</span><span class="SpanClass10"><strong><font color="#000080">.</font></strong></span><span class="SpanClass11">QuadPart</span><span class="SpanClass0">&nbsp;</span><span class="SpanClass10"><strong><font color="#000080">-</font></strong></span><span class="SpanClass0">&nbsp;</span><span class="SpanClass11">timeStart</span><span class="SpanClass10"><strong><font color="#000080">.</font></strong></span><span class="SpanClass11">QuadPart</span><span class="SpanClass10"><strong><font color="#000080">)</font></strong></span><span class="SpanClass0">&nbsp;</span><span class="SpanClass10"><strong><font color="#000080">*</font></strong></span><span class="SpanClass0">&nbsp;</span><span class="SpanClass4"><font color="#ff8000">1000</font></span><span class="SpanClass0">&nbsp;</span><span class="SpanClass10"><strong><font color="#000080">/</font></strong></span><span class="SpanClass0">&nbsp;</span><span class="SpanClass10"><strong><font color="#000080">(</font></strong></span><span class="SpanClass16"><font color="#8000ff">double</font></span><span class="SpanClass10"><strong><font color="#000080">)</font></strong></span><span class="SpanClass11">cpuFreq</span><span class="SpanClass10"><strong><font color="#000080">.</font></strong></span><span class="SpanClass11">QuadPart</span><span class="SpanClass10"><strong><font color="#000080">;</font></strong></span></font></font><span class="SpanClass0"><br /><font face="Courier New" size="2">&nbsp;&nbsp;&nbsp;&nbsp;</font></span><span class="SpanClass10"><strong><font face="Courier New" color="#000080" size="2">}</font></strong></span><span class="SpanClass0"><br /><br /><font face="Courier New" size="2">&nbsp;&nbsp;&nbsp;&nbsp;</font></span><font size="2"><font face="Courier New"><span class="SpanClass16"><font color="#8000ff">void</font></span><span class="SpanClass0">&nbsp;</span><span class="SpanClass11">Start</span><span class="SpanClass10"><strong><font color="#000080">()</font></strong></span></font></font><span class="SpanClass0"><br /><font face="Courier New" size="2">&nbsp;&nbsp;&nbsp;&nbsp;</font></span><span class="SpanClass10"><strong><font face="Courier New" color="#000080" size="2">{</font></strong></span><font size="2"><font face="Courier New"><span class="SpanClass0">&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="SpanClass11">QueryPerformanceCounter</span><span class="SpanClass10"><strong><font color="#000080">(</font></strong></span><span class="SpanClass0">&nbsp;</span><span class="SpanClass10"><strong><font color="#000080">&amp;</font></strong></span><span class="SpanClass11">timeStart</span><span class="SpanClass0">&nbsp;</<br />
span><span class="SpanClass10"><strong><font color="#000080">);</font></strong></span></span></font></font><font size="2"><font face="Courier New"><span class="SpanClass0">&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="SpanClass10"><strong><font color="#000080">}</font></strong></span></font></font><span class="SpanClass0"><br /><br /><font face="Courier New" size="2">&nbsp;&nbsp;&nbsp;&nbsp;</font></span><font size="2"><font face="Courier New"><span class="SpanClass16"><font color="#8000ff">void</font></span><span class="SpanClass0">&nbsp;</span><span class="SpanClass11">End</span><span class="SpanClass10"><strong><font color="#000080">()</font></strong></span></font></font><span class="SpanClass0"><br /><font face="Courier New" size="2">&nbsp;&nbsp;&nbsp;&nbsp;</font></span><span class="SpanClass10"><strong><font face="Courier New" color="#000080" size="2">{</font></strong></span><font size="2"><font face="Courier New"><span class="SpanClass0">&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="SpanClass11">QueryPerformanceCounter</span><span class="SpanClass10"><strong><font color="#000080">(</font></strong></span><span class="SpanClass0">&nbsp;</span><span class="SpanClass10"><strong><font color="#000080">&amp;</font></strong></span><span class="SpanClass11">timeEnd</span><span class="SpanClass0">&nbsp;</span><span class="SpanClass10"><strong><font color="#000080">);</font></strong></span></font></font><font size="2"><font face="Courier New"><span class="SpanClass0">&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="SpanClass10"><font color="#000080"><strong>}</strong></font></span></font></font><span class="SpanClass0"><br /></span><span class="SpanClass10"><strong><font face="Courier New" color="#000080" size="2">};</font></strong></span><span class="SpanClass0"><br /><br /><br /></span><font size="2"><font face="Courier New"><span class="SpanClass16"><font color="#8000ff">int</font></span><span class="SpanClass0">&nbsp;</span><span class="SpanClass11">main</span><span class="SpanClass10"><strong><font color="#000080">(</font></strong></span><span class="SpanClass16"><font color="#8000ff">int</font></span><span class="SpanClass0">&nbsp;</span><span class="SpanClass11">argc</span><span class="SpanClass10"><strong><font color="#000080">,</font></strong></span><span class="SpanClass0">&nbsp;</span><span class="SpanClass16"><font color="#8000ff">char</font></span><span class="SpanClass10"><strong><font color="#000080">*</font></strong></span><span class="SpanClass0">&nbsp;</span><span class="SpanClass11">argv</span><span class="SpanClass10"><font color="#000080"><strong>[])</strong></font></span></font></font><span class="SpanClass0"><br /></span><span class="SpanClass10"><strong><font face="Courier New" color="#000080" size="2">{</font></strong></span><span class="SpanClass0"><br /><font face="Courier New" size="2">&nbsp;&nbsp;&nbsp;&nbsp;</font></span><font size="2"><font face="Courier New"><span class="SpanClass11">HighPreTimer</span><span class="SpanClass0">&nbsp;</span><span class="SpanClass11">timer</span><span class="SpanClass10"><strong><font color="#000080">;</font></strong></span></font></font><span class="SpanClass0"><br /><br /><font face="Courier New" size="2">&nbsp;&nbsp;&nbsp;&nbsp;</font></span><font size="2"><font face="Courier New"><span class="SpanClass11">timer</span><span class="SpanClass10"><strong><font color="#000080">.</font></strong></span><span class="SpanClass11">Start</span><span class="SpanClass10"><strong><font color="#000080">();</font></strong></span></font></font><font size="2"><font face="Courier New"><span class="SpanClass0">&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="SpanClass11">Sleep</span><span class="SpanClass10"><strong><font color="#000080">(</font></strong></span><span class="SpanClass4"><font color="#ff8000">2000</font></span><span class="SpanClass10"><strong><font color="#000080">);</font></strong></span></font></font><span class="SpanClass0"><br /><font face="Courier New" size="2">&nbsp;&nbsp;&nbsp;&nbsp;</font></span><font size="2"><font face="Courier New"><span class="SpanClass11">timer</span><span class="SpanClass10"><strong><font color="#000080">.</font></strong></span><span class="SpanClass11">End</span><span class="SpanClass10"><strong><font color="#000080">();</font></strong></span></font></font><span class="SpanClass0"><br /><br /><font face="Courier New" size="2">&nbsp;&nbsp;&nbsp;&nbsp;</font></span><font size="2"><font face="Courier New"><span class="SpanClass11">printf</span><span class="SpanClass10"><strong><font color="#000080">(</font></strong></span><span class="SpanClass6"><font color="#808080">"%f&nbsp;second\n"</font></span><span class="SpanClass10"><strong><font color="#000080">,</font></strong></span><span class="SpanClass0">&nbsp;</span><span class="SpanClass11">timer</span><span class="SpanClass10"><strong><font color="#000080">.</font></strong></span><span class="SpanClass11">GetTime</span><span class="SpanClass10"><strong><font color="#000080">()</font></strong></span><span class="SpanClass0">&nbsp;</span><span class="SpanClass10"><strong><font color="#000080">/</font></strong></span><span class="SpanClass0">&nbsp;</span><span class="SpanClass4"><font color="#ff8000">1000</font></span><span class="SpanClass0">&nbsp;</span><span class="SpanClass10"><strong><font color="#000080">);</font></strong></span></font></font><span class="SpanClass0"><br /><font face="Courier New" size="2">&nbsp;&nbsp;&nbsp;&nbsp;</font></span><font size="2"><font face="Courier New"><span class="SpanClass5"><strong><font color="#0000ff">return</font></strong></span><span class="SpanClass0">&nbsp;</span><span class="SpanClass4"><font color="#ff8000">0</font></span><span class="SpanClass10"><strong><font color="#000080">;</font></strong></span></font></font><span class="SpanClass0"><br /></span><span class="SpanClass10"><strong><font face="Courier New" color="#000080" size="2">}</font></strong></span><span class="SpanClass0"><br /><br /></span></p>
